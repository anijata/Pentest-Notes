* The **Simple Mail Transfer Protocol** (**SMTP**) is an Internet standard communication protocol for electronic mail transmission. Usually runs on ports 25 (plaintext), 587 (encrypted).

* Reference: https://book.hacktricks.xyz/network-services-pentesting/pentesting-smtp

* Tools: `Evolution`,`Thunderbird`, `Claws`, `Geary`, `MailSpring`, `mutt`, `mailutils`, `sendEmail`, `swaks`, `sendmail`

* Enumeration using Nmap: `sudo nmap <ip> -sC -sV -p25,587`
	* NSE smtp open relay script to check if server is an open relay and is vulnerable to open relay attacks: `sudo nmap <ip> -p25,587 --script smtp-open-relay -v`
	* Further enumeration using Nmap NSE scripts for SMTP: `ls /usr/share/nmap/scripts/ | grep smtp`
	* Metasploit: `auxiliary/scanner/smtp/smtp_enum`

* Interacting with smtp: 
	* Use telnet to enumerate: `telnet <ip> <port>`

* Sending emails to smtp:
	* `swaks --from <from address> --to <to address> --header 'Subject: <subject>' --body '<body>' --server <ip>`
	* [Evolution](https://wiki.gnome.org/Apps/Evolution)

* smtp-user-enum: Enumerate for smtp user against a wordlist.
	* `smtp-user-enum -M <RCPT|VRFY|EXPN> -U <USERS file> -t <IP> [-D <domain>]`

* Cloud enumeration:
	* [O365spray](https://github.com/0xZDH/o365spray): 
		* Validate if domain uses O365: `python3 o365spray.py --validate --domain <domain>`
		* User enumeration: `python3 o365spray.py --enum -U <users file> --domain <domain>`
		* Password spray: `python3 o365spray.py --spray -U <users file> -p '<password>' --count 1 --lockout 1 --domain <domain>`
		
* Password spraying:
	* `hydra -L users.txt -p '<password>' -f <ip> smtp`

Requests on SMTP:
* VRFY: A VRFY request asks the server to verify an email address
* EXPN: EXPN asks the server for the membership of a mailing list
* How to invoke:
	* After a TCP connection or a shell is established, invoke requests by VRFY \<email address\> or EXPN \<mali-box\>
* Note that if someone is not authorized to access information of the smtp server an access denied msg is received.
* AUTH PLAIN: AUTH is a service extension used to authenticate the client.
* HELO: The client logs in with its computer name and thus starts the session.
* MAIL FROM: The client names the email sender.
 * RCPT TO: The client names the email recipient.
* DATA: The client initiates the transmission of the email.
* RSET:The client aborts the initiated transmission but keeps the connection between client and server.
* VRFY: The client checks if a mailbox is available for message transfer.
	* `VRFY <user>` can also be used to verify if `<user>` is valid. 
* EXPN: The client also checks if a mailbox is available for messaging with this command.
* NOOP: The client requests a response from the server to prevent disconnection due to time-out.
* QUIT: The client terminates the session.


 