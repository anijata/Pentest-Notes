* Create an SSH to create connection between two hosts.
* The connection is encrypted.
* SSH tunneling makes it user to blend in network traffic and passed off as administrative related network traffic.
* [[SSH Tunneling Quick Reference.png]]
* SSH local port forwarding:
	* Create an SSH connection for a local port forward.
	* `ssh -N -L 0.0.0.0:local_port:destination_server_ip:remote_port user@ssh_serverhostname`
	* Explanation: Open a local ssh forwarding from ssh client at `local port` to  `destination_server_ip:remote_port` using ssh server `ssh_serverhostname` as the pivot. `-L` is local port forwarding, `-N` is not open a shell for commands after authenticating with SSH.
* SSH Dynamic Port Forwarding:
	* Create an SSH connection for a local port forward and forward packets to any host accessible from the pivot without having to configure for each and every destination. This is the scalable version of  'SSH local port forwarding'.
	* `ssh -N -D 0.0.0.0:local_port user@ssh_server_hostname`.
	* Open a local dynamic ssh forwarding from ssh client at `local port` using ssh server `ssh_serverhostname` as the pivot. `-D` is for dynamic port forwarding, `-N` is not open a shell for commands after authenticating with SSH.
	* The dynamic port forwarding uses SOCKS proxy. The packets are forwarded to the SOCKS proxy which is also the ssh server acting as pivot. The packets contains a SOCKS header  about which host this packet should going to.
	* `Proxychains` on the attack machine can be used to forward packets over to the SOCKS proxy and adds SOCKS headers to the packets. 
	* Note: Proxychains can forward packets only if the binary used in the command is dynamically linked.
	* `/etc/proxychains4.conf` is the Proxychains config file. Append `socks5 <ip> <port>` to the file end.
	* Proxychains usage: `proxychains command`. This will forward packets from the `command` to the proxy ip port in each rule of proxychains4.conf file and proxy host will forward it to its intended destination. 
	* Depending on the situation you might want to **tcp_read_time_out** and **tcp_connect_time_out** values in the Proxychains configuration file to speed up non-responsive connection. This is useful for using tools like nmap.
* SSH Remote Port forwarding:
	* Useful when the victim network has firewall that restricts inbound connections.
	* This is the reverse of SSH local port forwarding where instead a connection is initiated from the SSH client which is the victim to the attack machine which is the SSH server. 
	* In local port forwarding the connection is inbound from SSH client connects to SSH server (similar to bind shell but for port forwarding). In remote port forwarding the connection is outbound from SSH client connects to SSH server (similar to reverse shell but for port forwarding).
	* `ssh -N -R 127.0.0.1:port1:ip2:port2 user@ssh_server` on SSH client
	* Explanation: Open a remote ssh forwarding from ssh client between `127.0.0.1:port1` to  `ip2:port2` using ssh server `ssh_server` as the pivot. `-R` is local port forwarding, `-N` is not open a shell for commands after authenticating with SSH. Important to note that `127.0.0.1:port1` in this case is where packets are forwarded to from SSH server's perspective.
* SSH Remote Dynamic Port Forwarding:
	* A scalable version of dynamic port forwarding where packets can be forwarded from the tunnel between ssh server and ssh client to any host(s) using ssh' socks proxy
	* `ssh -N -R sshserver_port user@ssh_server`
	* Explanation: Open a dynamic remote ssh forwarding from ssh client between using ssh server `ssh_server` as the pivot.`sshserver_port` is the listening port on SSH server where packets are sent towards it in SOCKS format. The packets are forwarded to to the ssh client which sends the packets to the correct recipients based on the SOCKS headers of the packet.. `-R` is local port forwarding, `-N` is not open a shell for commands after authenticating with SSH.
	* Like dynamic local port forwarding proxychains can be used for SOCKS headers of packets using command `proxychains command`. The proxy (ssh server ip port) has to be added to `/etc/proxychains4.conf`. 
* sshuttle:
	* sshuttle can be though of as a quick way to setup a VPN like  environment that setups up local routes using SSH tunnel.
	* Note: sshuttle requires root privileges on machine acting as SSH client and needs SSH authentication for machine acting as  the SSH server.
	* There is no need for proxy tools such as proxychain, since sshuttle creates local routes on the SSH client and any packets for the IPs in subnets will be forwarded through the SSH connection.
	* `sshuttle -r user@ip:port [subnet_1] [subnet_2] ... [subnet_n]`
	* Explanation: Specifies a remote SSH server at `ip:port` and uses SSH tunneling to tunnel packets to `[subnet_1] [subnet_2] ... [subnet_n]`. 