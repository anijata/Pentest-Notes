
* AV components: 
	* File Engine: Looks at file metadata and file signatatures.
	- Memory Engine: Looks at process memory
	- Network Engine: Analyze inbound and outbound traffic.
	- Disassembler: translates machine code to assembly and analyzes it. 
	- Emulator/Sandbox: Isolated environment to detonate malware.
	- Browser Plugin: AV plugins for monitoring browser.
	- Machine Learning Engine:  ML engine for recognizing unknown signatures or threats.
- AV detection methods:
	* Signature-based Detection: Scan file system for file signatures (hashes or binary string patterns)
	- Heuristic-based Detection: usually involves disassembly.
	- Behavioral Detection: Dynamic analysis in a sandbox usually.
	- Machine Learning Detection: ML algorithms using file metadata.
- AV evasion:
	- On-Disk: Evasion for malware that are physically on the disk.
		- Packer: Takes an executable and creates a smaller version. Used to evade in early days  since the binary structure is different.
		- Obfuscators: insert irrelevant instructions, reorder, split etc making it hard to reverse engineer. 
		- Crypter: encrypt and decode instructions then execute.
	 - In-Memory: Evade by manipulating memory directly. 
		 - Remote Process Memory Injection: 
			 - Inject the payload into another valid PE that is not malicious. The most common method of doing this is by leveraging a set of Windows APIs.
			 - OpenProcess opens a handle into the process. 
			 - Use VirtualAllocEx to allocate memory.
			 - WriteProcessMemory to copy your payload into memory. 
			 - CreateRemoteThread to launch a thread that executes the payload.
		 - Reflective DLL Injection: load a DLL stored by the attacker in the process memory.
			 - Problem with is method is that DLL needs to be loaded at runtime but the windows api can only loaded dlls on disk and not on the memory. It is possible to load it from memory in run time but it requires custom written dll loader api which can have its disadvantages.
		 - Process Hollowing:
			 - Launch a process in suspended state. Remove the image of process from memory. Place your own malicious image and execute it
		 - Inline hooking:
			 - Modify memory and introduce a hook (an instruction that redirects the code execution) into a function to make it point to malicious code and return back to the original process flow as if nothing happened.
			 - rootkits (malware that target system components, kernel, boot, hypervisor for persistence) often use inline hooking.
